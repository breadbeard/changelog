#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'highline/import'
require 'changelog'

include Methadone::Main

main do |release|

	# upcase head
	release = 'HEAD' if release == 'head' || release == 'next'

	# set repo path
  Changelog.repo_path = File.expand_path(options[:repo])

	# set release
	rls = Changelog::Release.new(release)
	
	if release == 'HEAD'
		release = ask("Next release tag (last: #{rls.previous_tag}) > ")
	end

	puts "\n#{Changelog::Header.new(release)}\n"

	rls.listings.each do |listing|
		puts listing
	end

	print "\n"
end

options[:repo] = ".git"

description "Generate markdown formatted changelog from your git revision tags"

on("-r REPO","--repo","Path to your git repository")
on("-m","--markdown","Output markdown formated")

arg :release, :required
arg :repo, :optional
arg :markdown, :optional

version Changelog::VERSION

go!
